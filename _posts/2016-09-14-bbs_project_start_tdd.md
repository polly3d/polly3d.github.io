---
layout: post
title: 【Laravel分享】一步一步构建类PHPHub网站：开始TDD吧！
---

系列文章索引：

* [【Laravel分享】一步一步构建类PHPHub网站：开始TDD吧！]()
* [【laravel分享】一步一步构建类PHPHub网站：先定个小目标]()
* [【laravel分享】一步一步构建类PHPHub网站：加入用户认证]()
* [【laravel分享】一步一步构建类PHPHub网站：模仿PHPHub]()
* [【laravel分享】一步一步构建类PHPHub网站：重构前端显示]()
* [【laravel分享】一步一步构建类PHPHub网站：优化篇]()

之前一直对TDD有兴趣，最近看了些PHP相关的内容，不满足只是写简单的测试用例，于是就发挥“好记性不如烂笔头”的功夫，使用TDD的方法写一个类似PHPHub的网站。
整个流程完成之后，感觉TDD真是一个非常实用的好东西。不敢独享，就写写使用TDD的一些体验，为后来者提供参考。
因为能力有限，行文和代码都有许多不足之处，请各位多多包涵。

言归正转，让我们开始TDD吧！

## 参考资料

在学习之前，先介绍几个比较好的学习资料。这样就可以解决初学都好多好多“什么”和“如何”的问题。比如说，
* 什么是TDD？
* php如何进行单元测试？
* 如何使用Laravel进行单元测试？
* 如何使用phpstorm进行单元测试？

这些问题在这些资料里面都会有所提及。只能帮到这里了，如果没有请自行搜索或提问。

参考资料列表：

* [如何使用PhpStorm實現TDD、重構與偵錯?](http://oomusou.io/phpstorm/phpstorm-tdd-refactor)
* [使用TDD實踐SOLID](http://oomusou.io/tdd/tdd-solid/)
* [Test Driven Laravel at Laracon US 2016](https://adamwathan.me/2016/08/11/test-driven-laravel/)
* [从Code Review 谈如何做技术](http://coolshell.cn/articles/11432.html)

前两个资料应该是台湾的兄弟写的，之前也在PHPHub论坛上推广过。有兴趣的可以直接在论坛上搜索。这两篇文章都是有视频的。如果想看视频，那也只能想办法了。我能说的就这么多。逃……
最后一个资料是Adam Wathan在Laracon US 2016的演讲视频，直接播放，肯定是播放不出来的。需要那啥，你懂的。Adam Wathan是Laravel的贡献者之一。这几年一直都是致力推广Laravel的TDD。他分享的代码和视频都是非常棒的。
最后一篇文章可能关系不大，但讲了一种工业的标准，意义挺大。

## 开始TDD

对于大部分的问题，比较倾向使用5W1H来分析。所谓的5W，就是what、why、when、where、who。1H指的就是how。就目前来说，我们对于TDD也仅仅需要知道what、why和how就可以了。剩下的问题可以留待以后成为更专业人士的时候，再去解答也不迟。

好吧，原形毕露了，其实也解答不出这三个问题。装X失败...

因为把那些东西写出来，估计一本书都不够。毕竟前人已经出了那么多对应的著作了。在这里写出来，估计也是复制粘贴，意义不大。有需要的，就自己动手，丰衣足食。

对于TDD，简单来说，就是通过写测试用例来推进开发。
TDD的基本流程如下：

编写测试用例-->红灯
编写功能代码-->绿灯
重构功能代码-->绿灯

有以下优点：

* 最重要的一点，开始写程序前，你会有一个非常明确的需求。这个可能很多人都没有意识到，通过都是想哪写的哪。而当你需要测试的时候，就会仔细考虑需求，周全的考虑各种边界。
* 当你的测试用例写完，并且通过测试的时候，其实你的程序也就写完了。
* 当你想重构代码时，可以直接重构，只需要把原来的测试重新再跑一遍就可以了。哪里出错改哪里。不用担心改了某个部分其他地方出错。
* 告别传统的写代码方式。可能很多人写代码都是这样的。写一行代码切换到浏览器，刷新，看看功能是否正常。不正常就继续修改，正常就继续写下一行。当然，写一行切一次有点夸张，但大部分逃不出这样一个界线。使用TDD后，起码可以不用再切来切去了。

缺点：

* 代码量增多

开始TDD吧，有失必有得。

## 开发阶段

我们的目标是开发一个类似PHPHub论坛的程序。在接下的几篇文章中，会根据不同的开发阶段，使用TDD流程，一步一步的完成开发。每个开发阶段都会对应一个git分支。
大概的开发阶段如下：

* 第一阶段：简单的论坛功能
    - 实现Post增删改查
    - 实现Comment增删改查
    - 实现Post与Comment的联表查询
* 第二阶段：增加Authentication
    - 增加用户认证
    - 增加注册、登陆
    - 增加只有登陆才能够发贴
    - 增加只能删除自己的Post或Comment
* 第三阶段：根据PHPHub的内容开发
    - 模拟PHPHub数据结构
    - Post的索引查询：活跃、精华、投票、最近、零回复
    - 用户中心
    - 增加点赞功能
    - Markdown功能（其实这个在最后的阶段才加，前期没关注）
* 第四阶段：进行UI开发并与功能整合
    - 使用Boostrap开发UI
    - 功能与UI整合
* 第五阶段：优化运行速度