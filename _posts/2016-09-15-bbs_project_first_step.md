---
layout: post
title: 【laravel分享】一步一步构建类PHPHub网站：先定个小目标
---

# 先定个小目标

先定个小目标，就一个亿吧。开玩笑，刚开始开发的时候，步子不要太大。对于一个论坛系统，最最基本的操作就是发贴和对帖子进行评论。到这里，最基本的测试用例就出来。同时也非常容易想到，帖子既然能够创建，那就应该是能够进行编辑、删除并且显示所有的帖子。以下，第一个小目标就制定完成了。

* 实现Post增删改查
* 实现Comment增删改查
* 实现Post与Comment的联表查询

# 第一个测试

发贴是一个论坛的基本功能，所以第一个测试用例就写发贴（即创建帖子）。

需要再次提一下的，就是测试的3A原则。所谓的3A，即Arrange，act，assert。

* Arrange
    - 建立对象（待测对象，依赖对象，模拟对象）
    - 建立假数据
    - 设定期望值
* Act
    - 实际执行待测对象的method，获得实际值
* Assert
    - 使用PHPUnint提供的assertion，测试期望值与实际值是否相等。

根据3A原则，我们的测试代码可以这样写。

```
/**
 * @test
 */
public function 新建Post()
{
    /** Arrange */
    /** Act */
    /** Assert */
}
```

上面的代码里面有两个内容需要说明一下。一是测试方法名称使用中文。方法是可以使用中文的，在测试里面使用中文的好处是能够非常快速的知道该测试的用途。二是@test。这个是PHPUnit提供的功能。如果某个方法要进行测试，有两种途径。一种是方法开头使用test为前缀。另外一种则是在注释里面加@test。

使用自然语言来描述一下测试的过程。

* 首先，创建帖子的主要数据
* 根据数据创建帖子
* 检查数据库中是否存在刚刚创建的帖子

翻译成代码如下：

```
/**
 * @test
 */
public function 新建Post()
{
    $data = [
        'title' =>  'hello',
        'content'   =>  'hello content',
    ];
    $post = Post::create($data);
    $this->seeInDatabase('posts',$data);
}
```

接下来，就是运行这个测试用例。毋庸置疑，运行这个测试肯定是会亮红灯的。不要紧张，回顾上一篇文章关于测试步骤的部分：红灯-->绿灯-->绿灯（重构）。
接下来，我们就来消除这个红灯。

# 让红灯变绿

根据上面的代码，我们需要建立一个Post类。而Post类就目前来说，最简单的就是使用Laravel的ORM。要建立一个Post，就要建立一个数据表。数据表有哪些字段呢？上面的虚构数据已经指出来了：title和content。

这就是由结果倒推整个流程的思路。这种思路非常的清晰，让你不会有多余的动作。经过这样的分析，接下来要做的就是这样：

* `artisan make:model Post -m`生成Post类和数据迁移表
* 在数据迁移表中，增加两个字段，一个是title(varchar)，一个是content(text)

最后，将上面的测试用例，引入相应的类，运行，绿灯就出现了！

剩下的需求，也按照同样的方式进行。相信很快就能够写完所有的增删改查内容了。

# 页面如何测试

Laravel提供了非常丰富的页面测试工具。以显示所有的Post的列表为例，代码如下：

```
/**
 * @test
 */
public function 显示所有Post()
{
    factory(Post::class)->create(['title'=>'my post']);
    $this->visit('/')
        ->see('my post');
}
```

就这么简单，就可以验证页面是否显示了某个Post的title。其他的内容类似，就不贴代码了。需要所有代码内容的，可以直接到我的git仓库里面查看 *1-first-step* 分支。

# 代码地址

以上内容的代码，请[点击](https://github.com/polly3d/bbs/tree/1-first-step)前往。

